<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat Grup - Alfamind</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        html{background:#1a1a2e;height:100%}
        body{font-family:Arial,sans-serif;background:#f5f5f5;max-width:420px;margin:0 auto;min-height:100vh;box-shadow:0 0 40px rgba(0,0,0,.3)}
        .status-bar{background:#fff;padding:8px 16px;display:flex;justify-content:space-between;font-size:11px;font-weight:bold;color:#333}
        .header{background:#fff;padding:12px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid #eee}
        .back{color:#e30613;font-size:24px;text-decoration:none;font-weight:bold}
        .header h1{font-size:16px;font-weight:600;color:#e30613}
        .content{padding:16px}
        .user-info{background:#fff;border-radius:12px;padding:14px 16px;margin-bottom:16px;box-shadow:0 1px 3px rgba(0,0,0,.08);display:flex;align-items:center;gap:10px}
        .user-avatar{width:40px;height:40px;background:#e30613;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:16px}
        .user-name{font-size:14px;font-weight:600;color:#333}
        .user-id{font-size:11px;color:#999}
        .section-title{font-size:14px;font-weight:600;color:#333;margin-bottom:12px}
        .empty{text-align:center;padding:40px 20px;color:#999;font-size:13px}
        .empty .icon{font-size:48px;margin-bottom:12px}
        .grup-list{display:flex;flex-direction:column;gap:10px}
        .grup-card{background:#fff;border-radius:12px;padding:14px 16px;box-shadow:0 1px 3px rgba(0,0,0,.08);display:flex;align-items:center;gap:12px;cursor:pointer;transition:.2s;text-decoration:none}
        .grup-card:hover{box-shadow:0 4px 8px rgba(0,0,0,.12)}
        .grup-icon{width:48px;height:48px;background:#e8f5e9;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}
        .grup-info{flex:1}
        .grup-name{font-size:14px;font-weight:600;color:#333}
        .grup-desc{font-size:11px;color:#999;margin-top:2px}
        .grup-members{font-size:10px;color:#aaa;margin-top:4px}
        .grup-arrow{color:#ccc;font-size:18px}
        .loading{text-align:center;padding:40px;color:#999;font-size:13px}
    </style>
</head>
<body>
<div class="status-bar"><span id="clock"></span><div>üì∂ üîã</div></div>
<div class="header">
    <a href="PusatBantuan.html" class="back">‚Äπ</a>
    <h1>Chat Grup</h1>
</div>
<div class="content">
    <div class="user-info">
        <div class="user-avatar" id="avatar"></div>
        <div>
            <div class="user-name" id="userName"></div>
            <div class="user-id" id="userId"></div>
        </div>
    </div>
    <div class="section-title">Grup Saya</div>
    <div id="grupList" class="grup-list">
        <div class="loading">‚è≥ Memuat grup...</div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
var SUPABASE_URL='https://xobpjlcxioldrttoietl.supabase.co';
var SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvYnBqbGN4aW9sZHJ0dG9pZXRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NTU2NTUsImV4cCI6MjA4NzEzMTY1NX0.GNjqP3Zv4V1B9qsFhscywc_Qor4SJ_4hy3-uG27Vm0E';
var sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

var user=JSON.parse(localStorage.getItem('user'));
if(!user) window.location.href='Login.html';

document.getElementById('avatar').textContent=user.nama.charAt(0).toUpperCase();
document.getElementById('userName').textContent=user.nama;
document.getElementById('userId').textContent='ID: '+user.memberId;

async function loadGroups(){
    var container=document.getElementById('grupList');
    var {data:members,error}=await sb.from('chat_group_members').select('group_id').eq('member_id',user.memberId);
    if(error||!members||members.length===0){
        container.innerHTML='<div class="empty"><div class="icon">üí¨</div>Belum ada grup chat.<br>Hubungi admin untuk bergabung.</div>';
        return;
    }
    var groupIds=members.map(function(m){return m.group_id;});
    var {data:groups}=await sb.from('chat_groups').select('*').in('id',groupIds).eq('is_active',true);
    if(!groups||groups.length===0){
        container.innerHTML='<div class="empty"><div class="icon">üí¨</div>Belum ada grup chat aktif.</div>';
        return;
    }
    var html='';
    for(var i=0;i<groups.length;i++){
        var g=groups[i];
        html+='<a class="grup-card" href="ChatRoom.html?id='+g.id+'">';
        html+='<div class="grup-icon">üí¨</div>';
        html+='<div class="grup-info">';
        html+='<div class="grup-name">'+g.nama_grup+'</div>';
        html+='<div class="grup-desc">'+(g.deskripsi||'')+'</div>';
        html+='</div>';
        html+='<span class="grup-arrow">‚Ä∫</span>';
        html+='</a>';
    }
    container.innerHTML=html;
}
loadGroups();

function updateClock(){var d=new Date();document.getElementById('clock').textContent=d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0');}
updateClock();setInterval(updateClock,1000);
</script>
</body>
</html>
