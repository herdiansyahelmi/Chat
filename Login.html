<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e30613">
    <meta name="description" content="Aplikasi chat grup untuk komunitas Alfamind">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Alfamind">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/Alfamind.jpg">
    <link rel="apple-touch-icon" href="/Alfamind.jpg">
    <title>Login - Alfamind</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        html{background:#1a1a2e;height:100%}
        body{font-family:Arial,sans-serif;background:#fff;max-width:420px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;position:relative;box-shadow:0 0 40px rgba(0,0,0,.3)}
        .install-banner{background:linear-gradient(135deg,#e30613,#ff4d4d);color:#fff;padding:12px 16px;display:none;align-items:center;gap:12px;position:fixed;bottom:0;left:0;right:0;max-width:420px;margin:0 auto;z-index:200;box-shadow:0 -2px 10px rgba(0,0,0,.2)}
        .install-banner.show{display:flex}
        .install-icon{font-size:32px}
        .install-info{flex:1}
        .install-info h4{font-size:14px;font-weight:bold;margin-bottom:2px}
        .install-info p{font-size:11px;opacity:.9}
        .install-btn{background:#fff;color:#e30613;padding:8px 16px;border-radius:20px;font-size:12px;font-weight:bold;border:none;cursor:pointer}
        .install-close{color:#fff;font-size:20px;cursor:pointer;padding:4px}
        .status-bar{background:#e30613;padding:8px 16px;display:flex;justify-content:space-between;font-size:11px;color:#fff;font-weight:bold}
        .red-section{background:#e30613;padding:20px 24px 60px;position:relative;overflow:hidden}
        .red-section::after{content:'';position:absolute;bottom:-30px;left:-10%;width:120%;height:80px;background:#fff;border-radius:50% 50% 0 0}
        .top-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
        .logo{background:#fff;padding:6px 16px;border-radius:6px}
        .logo span{color:#e30613;font-weight:900;font-size:20px;font-style:italic}
        .skip{color:#fff;font-size:14px;font-weight:bold;cursor:pointer;text-decoration:none}
        .hero-title{color:#fff;font-size:28px;font-weight:900;line-height:1.2;margin-bottom:14px}
        .hero-desc{color:#fff;font-size:15px;line-height:1.5;opacity:.95}
        .form-section{flex:1;padding:40px 24px 24px}
        .form-label{font-size:14px;color:#333;margin-bottom:10px}
        .form-label span{color:#e30613}
        .form-input{width:100%;padding:14px 16px;border:1px solid #ddd;border-radius:8px;font-size:15px;color:#333;outline:none;margin-bottom:12px}
        .form-input::placeholder{color:#bbb}
        .form-input:focus{border-color:#e30613}
        .terms{font-size:13px;color:#555;line-height:1.5}
        .terms strong{color:#333}
        .terms a{color:#e30613;text-decoration:none;font-style:italic;font-weight:bold}
        .btn-masuk{display:block;width:100%;padding:16px;background:#e30613;color:#fff;border:none;border-radius:30px;font-size:16px;font-weight:bold;cursor:pointer;margin-top:40px}
        .btn-masuk:hover{background:#c70511}
        .btn-masuk:disabled{background:#ccc;cursor:not-allowed}
        .error{background:#fee;color:#c33;padding:10px;border-radius:8px;margin-bottom:12px;text-align:center;font-size:13px;display:none}
        .home-bar{background:#fff;padding:8px 0;display:flex;justify-content:center;border-top:1px solid #eee}
        .home-indicator{width:120px;height:4px;background:#333;border-radius:2px}
    </style>
</head>
<body>
<div class="install-banner" id="installBanner">
    <div class="install-icon">ðŸ“±</div>
    <div class="install-info">
        <h4>Install Aplikasi</h4>
        <p>Dapatkan notifikasi meski browser ditutup</p>
    </div>
    <button class="install-btn" id="installBtn">Install</button>
    <span class="install-close" onclick="closeInstallBanner()">âœ•</span>
</div>
<div class="status-bar">
    <span id="clock">14:08</span>
    <div>ðŸ“¶ ðŸ”‹</div>
</div>
<div class="red-section">
    <div class="top-bar">
        <div class="logo"><span>Alfamind</span></div>
        <a href="#" class="skip">Lewati</a>
    </div>
    <div class="hero-title">Jadi Store Owner di Alfamind</div>
    <div class="hero-desc">Wujudkan mimpi kamu memiliki usaha ritel sendiri dan mendapatkan penghasilan tambahan dari rumah.</div>
</div>
<div class="form-section">
    <div class="error" id="error"></div>
    <div class="form-label">Nomor HP Kamu<span>*</span></div>
    <input type="tel" id="noTlp" class="form-input" placeholder="Contoh: 081316200344">
    <div class="terms">Dengan Masuk / Daftar berarti kamu sudah <strong>Setuju</strong> dengan <a href="#">Syarat & Ketentuan</a> yang berlaku.</div>
    <button class="btn-masuk" id="btnMasuk">Masuk / Daftar</button>
</div>
<div class="home-bar"><div class="home-indicator"></div></div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
var SUPABASE_URL = 'https://xobpjlcxioldrttoietl.supabase.co';
var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvYnBqbGN4aW9sZHJ0dG9pZXRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NTU2NTUsImV4cCI6MjA4NzEzMTY1NX0.GNjqP3Zv4V1B9qsFhscywc_Qor4SJ_4hy3-uG27Vm0E';
var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// PWA Install Prompt
var deferredPrompt;
window.addEventListener('beforeinstallprompt', function(e) {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById('installBanner').classList.add('show');
});

document.getElementById('installBtn').addEventListener('click', function() {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(function(choiceResult) {
            if (choiceResult.outcome === 'accepted') {
                console.log('User accepted install');
            }
            deferredPrompt = null;
            closeInstallBanner();
        });
    }
});

function closeInstallBanner() {
    document.getElementById('installBanner').classList.remove('show');
    localStorage.setItem('installBannerClosed', 'true');
}

// Jangan tampilkan banner jika sudah pernah ditutup
if (localStorage.getItem('installBannerClosed')) {
    document.getElementById('installBanner').style.display = 'none';
}

// Register Service Worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
        .then(function(reg) { console.log('SW registered'); })
        .catch(function(err) { console.log('SW registration failed:', err); });
}

document.getElementById('btnMasuk').addEventListener('click', async function(){
    var btn = this;
    var noTlp = document.getElementById('noTlp').value.trim();
    if(!noTlp){ showError('Masukkan nomor HP!'); return; }
    btn.disabled = true; btn.textContent = 'Mengecek...';
    var { data, error } = await supabase.from('data_user').select('memberId, noTlp, nama').eq('noTlp', noTlp).single();
    btn.disabled = false; btn.textContent = 'Masuk / Daftar';
    if(error || !data){ showError('Nomor HP tidak terdaftar!'); return; }
    localStorage.setItem('noTlp', noTlp);
    localStorage.setItem('userName', data.nama);
    window.location.href = 'Password.html';
});

function showError(msg){
    var el = document.getElementById('error');
    el.textContent = msg; el.style.display = 'block';
    setTimeout(function(){ el.style.display='none'; }, 3000);
}
function updateClock(){var d=new Date();document.getElementById('clock').textContent=d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0');}
updateClock();setInterval(updateClock,1000);
</script>
</body>
</html>
